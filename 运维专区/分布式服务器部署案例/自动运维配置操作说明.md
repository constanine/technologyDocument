## 自动运维配置操作说明
   #### 1 运维前期准备工作
   ##### 1.1 用户准备,参考部署段落中章节[1.1 用户准备]
   ##### 1.2 运维脚本的下载
   ```shell
   svn co https://172.19.20.72/svn/Yigo项目/release-publish/应用服务器运维帮助;
   ```
   ##### 1.3 运维脚本的使用预备
   ```shell
   cp ~/应用服务器运维帮助/*.sh /data/devops/;
   ```
   #### 2 数据库备份服务器上的运维
   ##### 2.1 mysql数据定时备份
   ###### 2.1.1 切换到用户mysql或者dveops下
   ```shell
   su - mysql;
   ```
   ###### 2.1.2 编辑定时任务
   ```shell
   crontab -e;
   ```
   ###### 2.1.3 加入下列内容,表示每天晚上9点半回去备份1次数据库文件,并且压缩
   ```shell
   30 21 * * * /data/devops/shell/mysql-backup.sh
   ```
   ###### 2.1.4 保存退出
   ```shell
   #按下ESC键
   :wq
   #并回车
   ```
   ###### 2.1.5 编辑用户`mysql`的`~/.bashrc`文件
   ```shell
   vi ~/.bashrc
   ```
   ###### 2.1.6 加入下列内容,配置备份数据库的数据库连接配置
   ```shell
   export MYSQL_USERNAME=zszg                     #请参照具体的数据库用户名
   export MYSQL_PASSWORD=zszg111                  #请参照具体的数据库用户密码
   export MYSQL_SERVER_HOST=172.19.20.125         #请参照具体的数据库服务的服务器ip
   export MYSQL_SERVER_PORT=3306                  #请参照具体的数据库服务端口
   export ARCHIVE_DATE=15                         #设置归档日志,一般默认每个月的15号
   ```
   ###### 2.1.7 保存退出
   ```shell
   #按下ESC键
   :wq
   #并回车
   ```
   ###### 2.1.8 查看备份文件,一般`/data/devops/backup/daily`,`/data/devops/backup/archive`,下可以看见备份的压缩sql文件,建议定期复制出来保存,以防万一

   #### 3 应用服务器上的运维

   ##### 3.1 YIGO服务运行状态监听
   ###### 3.1.1 切换到用户boke
   ```shell
        su - boke
   ```
   ###### 3.1.2 编辑定时任务
   ```shell
   crontab -e;
   ```
   ###### 3.1.3 输入以下内容
   ```shell
   */10 * * * * /data/devops/shell/yigo-all-server-keepalive-listen.sh
   ```
   ###### 3.1.4 保存编辑并推出
   ```shell
   #按下ESC键
   :wq
   #并回车
   ```
   ###### 3.1.5 查看定任务的编辑结果
   ```shell
   crontab -l;
   ```
   ###### 3.1.6 等待10分钟后,在`/data/devops/logs/yigo-all-server`可以查看到监听日志文件
   ```shell
   ll /data/devops/logs/yigo-all-server
   ```

   ##### 3.2 应用服务器开机启动YIGO服务
   ###### 3.2.1 切换到用户root
   ```shell
   sudo su -
   ```
   ###### 3.2.2 编辑`/etc/rc.local`文件
   ```shell
   vi /etc/rc.local
   ```
   ###### 3.2.3 添加以下内容
   ```shell
   su - boke -c /data/devops/shell/yigo-all-server-keepalive-listen.sh
   ```
   ###### 3.2.4 保存编辑并推出
   ```shell
   #按下ESC键
   :wq
   #并回车
   ```
   ###### 3.2.5 查看内容为
   ```shell
   #!/bin/bash
   # THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES
   #
   # It is highly advisable to create own systemd services or udev rules
   # to run scripts during boot instead of using this file.
   #
   # In contrast to previous versions due to parallel execution during boot
   # this script will NOT be run after all other services.
   #
   # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure
   # that this script will be executed during boot.

   touch /var/lock/subsys/local
   su - boke -c /data/devops/shell/yigo-all-server-keepalive-listen.sh
   ```
   ###### 3.2.6 给予`/etc/rc.local`文件赋予执行权
   ```shell
   chmod +x /etc/rc.local;
   chmod +x /etc/rc.d/rc.local; #centos特有的结构,如果是ubuntu系统请无视
   ```

   ##### 3.3 多媒体文件（附件）的备份工作
   ###### 3.3.1 切换到用户boke
   ```shell
   su - boke
   ```
   ###### 3.3.2 编辑定时任务
   ```shell
   crontab -e;
   ```
   ###### 3.3.3 添加以下内容
   ```shell
    30 21 * * * /data/devops/shell/attachment-file-backup.sh
   ```
   ###### 3.3.4 保存编辑并推出
   ```shell
   #按下ESC键
   :wq
   #并回车
   ```
   ###### 3.3.5 查看定时任务,参考已经添加了过运行状态的监听,所以应该有2个定时任务
   ```shell
   crontab -l;
   ```